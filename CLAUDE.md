# Инструкции для Claude Code

## О проекте

Сайт компании SK-Rosa (ремонтные услуги). **180+ HTML страниц**.

**Технологии:**
- Vite 7.3 для сборки
- Vanilla JavaScript (ES modules)
- SCSS (компилируется в CSS)
- HTML статические страницы
- Генератор для массового создания городских страниц

## Структура файлов

```
src/
├── index.html              # Главная страница
├── pages/                  # HTML страницы
│   ├── articles/          # Статьи блога (URL: /blog/*)
│   ├── plastering/        # Городские страницы услуги "Штукатурка" (172+ файла, генерируются)
│   ├── turnkey-repair/    # Городские страницы "Ремонт под ключ" (генерируются)
│   ├── airless-painting/  # Городские страницы "Покраска" (генерируются)
│   ├── floor-screed/      # Городские страницы "Стяжка пола" (генерируются)
│   ├── blog.html          # Список статей блога
│   ├── calculator.html    # Калькулятор
│   └── ...                # Другие страницы
├── scripts/
│   ├── core/              # Базовая функциональность (carousel, main.js)
│   ├── features/          # Функции по разделам (calculator, portfolio, contact, blog, faq)
│   └── modules/           # Переиспользуемые модули
├── styles/
│   ├── main.scss          # Главный файл стилей
│   ├── blocks/            # Компоненты (кнопки, формы, карточки)
│   └── helpers/           # Утилиты и переменные
└── assets/
    ├── images/            # Изображения (предпочтителен WebP)
    ├── icons/             # Иконки
    └── videos/            # Видео

scripts/generator/          # Генератор городских страниц
public_html/               # Готовая сборка (НЕ РЕДАКТИРОВАТЬ)
```

**Алиасы импортов:**
```javascript
import "@/file.js"              // → src/file.js
import "@scripts/core/bar"      // → src/scripts/core/bar
import "@features/calc/baz"     // → src/scripts/features/calc/baz
import "@styles/main.scss"      // → src/styles/main.scss
```

## Правила генерации кода

### JavaScript (ESLint + Prettier)

**КРИТИЧНО:** Весь JS код автоматически проверяется перед сборкой (`npm run build` включает линтинг).

**Обязательные правила ESLint (ошибка = сборка не пройдёт):**
- ✅ Используй `const` или `let`, НИКОГДА `var`
- ✅ Используй `===` и `!==`, НИКОГДА `==` или `!=`
- ✅ Всегда используй фигурные скобки для `if`, `for`, `while`, даже для одной строки
  ```javascript
  // ❌ НЕПРАВИЛЬНО
  if (foo) return bar;

  // ✅ ПРАВИЛЬНО
  if (foo) {
    return bar;
  }
  ```

**Предупреждения ESLint:**
- Используй `prefer-const` для неизменяемых переменных
- Удаляй неиспользуемые переменные или префикс `_` для игнорирования
- Не используй `console.log()`, только `console.error()` и `console.warn()`

**Форматирование Prettier (автоприменяется):**
- Точка с запятой: **ДА** (обязательно)
- Кавычки: **двойные `"`**
- Отступы: **2 пробела**
- Длина строки: **100 символов**
- Arrow functions: **без скобок для одного параметра** (`x => x * 2`)
- Trailing comma: **es5** (в объектах и массивах)

**Пример правильного кода:**
```javascript
const calculatePrice = (area, pricePerMeter) => {
  if (!area || !pricePerMeter) {
    console.error("Missing required parameters");
    return 0;
  }

  const total = area * pricePerMeter;
  return Math.round(total);
};
```

**Глобальные переменные (определены в eslint.config.js):**
- `ymaps` - Яндекс.Карты API
- Стандартные browser globals (window, document, fetch, etc.)

### SCSS/CSS (Stylelint)

**Конфигурация:** `stylelint-config-standard-scss`

**Правила:**
- Стандартные правила SCSS
- Отключены: именование классов, кастомных свойств, проверка избыточных longhand свойств
- Всегда используй автоисправление: код будет отформатирован при сборке

### HTML

- Контент на **русском языке**
- CSS подключай через `<link>`, **НЕ inline стили**
- Пути к ресурсам: относительные (`./assets/`, `../assets/`)
- Не используй эмодзи без явного запроса

## Генератор городских страниц

**КРИТИЧНО:** 172+ городских страницы создаются через генератор, НЕ вручную!

**Проблема:** Сборка 180+ HTML страниц через Vite вызывает OOM (Out Of Memory).

**Решение:** Генератор в `scripts/generator/` создаёт страницы отдельно.

**Команды:**
```bash
npm run generate         # Генерация для dev (src/pages/)
npm run generate:build   # Генерация для production (public_html/)
npm run generate:clean   # Очистка сгенерированных страниц
```

**Что делать:**
- ✅ При запросе создать городскую страницу → редактируй `scripts/generator/cities-data.js`
- ✅ При изменении шаблона → редактируй файлы в `scripts/generator/templates/`
- ❌ **НИКОГДА** не создавай городские страницы вручную в `src/pages/plastering/*.html`
- ❌ **НИКОГДА** не редактируй сгенерированные файлы напрямую (изменения потеряются)

**Какие страницы генерируются:**
- `src/pages/plastering/[city].html` (172+ города)
- `src/pages/turnkey-repair/[city].html`
- `src/pages/airless-painting/[city].html`
- `src/pages/floor-screed/[city].html`

## Команды проекта

### Основные
```bash
npm run dev              # Dev сервер :3000
npm run build            # Полная сборка (линт + vite + генератор)
npm run preview          # Превью сборки :4173
```

### Сборка для разных окружений
```bash
npm run build:hosting    # Для хостинга (BASE_PATH=./)
npm run build:github     # Для GitHub Pages (BASE_PATH=/sk-rosa/)
npm run build:heavy      # С увеличенным лимитом памяти (OOM workaround)
npm run build:vite       # Только Vite, без генератора
```

### Линтинг
```bash
npm run lint             # Проверка JS + CSS
npm run lint:fix         # Автоисправление JS + CSS
npm run format           # Prettier для всех файлов
npm run fix              # Всё вместе: lint + lint:fix + format
```

## Что НУЖНО делать

### При написании JavaScript
1. **ВСЕГДА** используй правила ESLint (const/let, ===, фигурные скобки)
2. Форматируй код по Prettier (двойные кавычки, точка с запятой)
3. Удаляй `console.log()`, оставляй только `console.error/warn`
4. Используй алиасы импортов (`@scripts`, `@features`, `@core`)

### При написании HTML
1. Используй относительные пути к ресурсам
2. Подключай CSS через `<link rel="stylesheet">`
3. Весь текст на русском языке

### При работе с городскими страницами
1. **ВСЕГДА** используй генератор (`npm run generate`)
2. Редактируй шаблоны в `scripts/generator/`, НЕ файлы в `src/pages/*/`
3. Добавляй новые города в `scripts/generator/cities-data.js`

### При изменении существующего кода
1. Читай файл целиком перед изменением
2. Сохраняй существующий стиль форматирования
3. Не рефактори без запроса
4. Не добавляй комментарии без необходимости

## Что НЕ нужно делать

### ❌ Не создавай файлы без запроса
- README.md, CONTRIBUTING.md, TODO.md
- Дополнительные конфигурационные файлы
- Документацию в комментариях

### ❌ Не усложняй код
- Не рефактори без явного запроса
- Не создавай абстракции "на будущее"
- Не добавляй обработку ошибок "на всякий случай"
- Код должен быть минималистичным

### ❌ Не меняй структуру проекта
- Не перемещай файлы между директориями
- Не переименовывай директории
- Не меняй настроенные алиасы импортов

### ❌ Не игнорируй линтер
- Не генерируй код с `var`, `==`, без фигурных скобок
- Не отключай правила ESLint/Stylelint
- `npm run build` автоматически проверяет код - он должен проходить

### ❌ Не создавай городские страницы вручную
- Только через генератор
- Только редактирование `scripts/generator/`

## Частые задачи

### Добавить новую городскую страницу
1. Редактируй `scripts/generator/cities-data.js`
2. Запусти `npm run generate`
3. Проверь результат в `src/pages/[service]/[city].html`

### Добавить статью в блог
1. Создай файл `src/pages/articles/article-name.html`
2. Добавь ссылку в `src/pages/blog.html`
3. URL статьи будет `/blog/article-name`

### Изменить цены
- Цены в HTML: `src/pages/plastering.html`, `turnkey-repair.html` и др.
- Калькулятор: `src/pages/calculator.html`

### Изменить JavaScript функциональность
1. Найди файл в `src/scripts/`
2. Внеси изменения (соблюдая ESLint правила)
3. Проверь код: `npm run lint`

## Типичные проблемы

### OOM при сборке
**Симптом:** `JavaScript heap out of memory`
**Решение:** Используй `npm run build:heavy` (увеличенный лимит памяти)

### Линтер выдаёт ошибки после генерации кода
**Причина:** Сгенерировал код с `var`, `==` или без фигурных скобок
**Решение:** Перегенерируй код, соблюдая правила ESLint

### Изменения в городских страницах не сохраняются
**Причина:** Редактировал сгенерированные файлы напрямую
**Решение:** Редактируй шаблоны в `scripts/generator/`

## Оптимизация работы

### Когда пользователь открывает файл в IDE
- Ты автоматически видишь содержимое - не нужно его читать снова
- Используй это для быстрых правок

### Когда пользователь выделяет код
- Ты видишь выделенный фрагмент - фокусируйся на нём
- Не нужно искать нужный участок кода

### Группировка операций
- Если нужно изменить один текст в 5 файлах - делай за один раз
- Используй массовые замены через паттерны

### Проверка перед генерацией
- Убедись, что код соответствует ESLint/Prettier правилам
- Генерируй код сразу правильно, чтобы не было ошибок при сборке

## Контрольный список перед ответом

**JavaScript:**
- [ ] Используешь `const/let`, НЕ `var`?
- [ ] Используешь `===`, НЕ `==`?
- [ ] Фигурные скобки везде (if/for/while)?
- [ ] Двойные кавычки, точка с запятой?
- [ ] Нет `console.log()` (только error/warn)?

**Общее:**
- [ ] Не создаёшь лишние файлы?
- [ ] Не рефакторишь без запроса?
- [ ] Не меняешь структуру проекта?
- [ ] Используешь генератор для городских страниц?
- [ ] Код пройдёт `npm run build` без ошибок?
